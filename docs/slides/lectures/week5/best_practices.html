<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Project Organization</title>
    <meta charset="utf-8" />
    <meta name="author" content="Abhijit Dasgupta" />
    <link href="best_practices_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="best_practices_files/xaringanExtra-extra-styles-0.2.2/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <link href="best_practices_files/tile-view-0.2.2/tile-view.css" rel="stylesheet" />
    <script src="best_practices_files/tile-view-0.2.2/tile-view.js"></script>
    <script src="best_practices_files/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="best_practices_files/shareon-1.4.1/shareon.min.css" rel="stylesheet" />
    <script src="best_practices_files/shareon-1.4.1/shareon.min.js"></script>
    <link href="best_practices_files/xaringanExtra-shareagain-0.2.2/shareagain.css" rel="stylesheet" />
    <script src="best_practices_files/xaringanExtra-shareagain-0.2.2/shareagain.js"></script>
    <link rel="stylesheet" href="../../css/robot.css" type="text/css" />
    <link rel="stylesheet" href="../../css/robot-fonts.css" type="text/css" />
    <link rel="stylesheet" href="../../css/sfah.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Project Organization
### Abhijit Dasgupta
### BIOF 339

---






layout: true

&lt;div class="my-header"&gt;
&lt;span&gt;BIOF 339: Practical R&lt;/span&gt;
&lt;/div&gt;


---

# Objectives 

+ Project Organization
    - How to maintain long-term sanity
    
---

# Why organize?

## Common Objectives

+ Maximize
    + Time to think about a project
    + Reliability/Reproducibility
+ Minimize
    + Data errors
    + Programmer/Analyst errors
    + Programming Time
    + Re-orientation time when revisiting
    
---

## Our inclination

+ Once we get a data set
    + Dig in!!
    + Start "playing" with tables and figures
    + Try models on-the-fly
    + Cut-and-paste into reports and presentations

--

&lt;p style="color:red;font-size:180%;text-align:center;"&gt;
DON'T DO THIS!!
&lt;/p&gt;

---
class: inverse, middle, center
# Abhijit's story

---

## Many years ago

+ 25 year study of rheumatoid arthritis
+ 5600 individuals
+ Several cool survival analysis models
+ Needed data cleaning, validation and munging, and some custom computations
+ Lots of visualizations

---
background-image: url(http://www.villaravioli.com/admin/incoming/20160930091420_Capellini.png)
background-size: contain

## Many years ago

.left-column70[
+ Resulted in a muddle of 710 files (starting from 4 data files)
+ Unwanted cyclic dependencies for intermediate data creation
+ Lots of ad hoc decisions and function creation with scripts
+ Almost impossible to re-factor and clean up
+ Had to return to this project for 3 research papers and revision cycles!!!
]
.right-column30[![](../img/spaghetti.jpg)]    

.center[![](https://media.giphy.com/media/4LsN0YwgIsvaU/giphy.gif)]

---
class: center, middle

# Who's the next consumer of your work??

--

.pull-left[
## Yourself in 

3 months

1 year

5 years
]
.pull-right[
![](https://media.giphy.com/media/kxAX99ncvbPk4/giphy.gif)
]
--

####  Can't send your former self e-mail asking what the frak you did.

---
class: inverse, middle, center

## Biggest reason for good practices is 


&lt;p style="font-size:200%; text-align: center; color: yellow;" &gt; YOUR OWN SANITY &lt;/p&gt;

---
class: inverse, middle, center

# RStudio Projects

.footnote[.right[[description](#proj1)]]

---

## RStudio Projects

&lt;img src="../img/project1.png" width="4139" /&gt;

---

## RStudio Projects
&lt;img src="../img/project2.png" width="4139" /&gt;

---

## RStudio Projects
&lt;img src="../img/project3.png" width="4139" /&gt;

---

## RStudio Projects
&lt;img src="../img/project4.png" width="4139" /&gt;

---

## RStudio Projects
&lt;img src="../img/project5.png" width="4139" /&gt;

---

## RStudio Projects
&lt;img src="../img/project6.png" width="4139" /&gt;

---

## RStudio Projects
&lt;img src="../img/project7.png" width="4139" /&gt;

---
name: proj1

## RStudio Projects

When you create a Project, the following obvious things happen:

1. RStudio puts you into the right directory/folder
2. Creates a .Rproj file containing project options
    + You can double-click on the .Rproj file to open the project in RStudio
3. Displays the project name in the project toolbar (right top of the window)

---

## RStudio Projects

The following not-so-obvious things happen:

1. A new R session (process) is started
2. The .Rprofile file in the project’s main directory (if any) is sourced by R
3. The .RData file in the project’s main directory is loaded (this can be controlled by an option).
4. The .Rhistory file in the project’s main directory is loaded into the RStudio History pane (and used for Console Up/Down arrow command history).
5. The current working directory is set to the project directory.
6. Previously edited source documents are restored into editor tabs, and
7. Other RStudio settings (e.g. active tabs, splitter positions, etc.) are restored to where they were the last time the project was closed.

---

## RStudio Projects

I use [Projects]() so that:

1. I'm always in the right directory for the project
2. I don't contaminate one project's analysis with another (different sandboxes)
3. I can access different projects quickly
4. I can version control them (Git) easily (topic for beyond this class)
5. I can customize options per project

.footnote[A great reference for git from a R user's perspective is Jenny Bryan's excellent [happygitwithr.com](https://happygitwithr.com/)]
---

## RStudio Projects
&lt;img src="../img/project8.png" width="4139" /&gt;

---
class: inverse, middle, center

# Project organization

---

## Project structure

I always work with RStudio Projects to encapsulate my projects.  

However, each project needs to maintain a file structure to know where to find things

---

## Use a template to organize each project

+ Before you even get data
+ Set up a particular folder structure where
    + You know what goes where
    + You already have canned scripts/packages set up
+ Make sure it's the same structure __every time__
+ Next time you visit, you don't need to go into desperate search mode

---
class: center

&lt;img src="../img/best_practices_structure.png" width="2496" /&gt;

---

## File naming

+ Use descriptive file names
+ Be explicit
    + File1.R, File4.R won't help you
    + DataMunging.R, RegressionModels.R will
+ Well-chosen names saves a lot of time and heartache
+ Another choice is to let yourself know the order of how things are to be run in a workflow by naming files
    + 01-Ingestion.R
    + 02-Munging.R
    + 03-EDA.R
    + 04-Modeling.R

---

## Documentation

+ Create at least a README file to describe what the project is about.
+ I've started creating a "lab notebook" for data analyses
    + Usually named `Notebook.Rmd`
    + Either a straight R Markdown file or a R Notebook
    + Keep notes on
        + What products (data sets, tables, figures) I've created
        + What new scripts I've written
        + What new functions I've written
        + Notes from discussions with colleagues on decisions regarding data, analyses, final products
  
---

## Documentation

+ Document your code as much as you can
    + Copious comments to state what you're doing and why
+ If you write functions
    + Use [Roxygen](https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html) to document the inputs, outputs, what the function does and an example

---

&lt;img src="../img/roxygen.png" width="4139" /&gt;

---

&lt;img src="../img/roxygen2.png" width="3840" /&gt;

----

&lt;img src="../img/roxygen3.png" width="4139" /&gt;

---

#Function sanity

## The computer follows direction really well

+ Use scripts/functions to derive quantities you need  for other functions
+ Don't hard-code numbers


```r
runif(n = nrow(dat), min = min(dat$age), max = max(dat$age))
```
rather than

```r
runif(n = 135, min = 18, max = 80)
```

+ This reduces potential errors in data transcription
    + These are really hard to catch

---

## Create functions rather than copy-paste code

+ If you're doing the same thing more than twice, write a function (_DRY principle_)
+ Put the function in its own file, stored in a particular place
    + I store them in `lib/R`.
    + Don't hide them in general script files where other stuff is happening
    + Name the file so you know what's in it
    + One function or a few related functions per file
+ Write the basic documentation __NOW__!

-----

An example from my own work is [here](https://github.com/webbedfeet/USRDS2015/tree/master/lib/R)

---

## Loading your functions


```r
funcfiles &lt;- dir('lib/R', pattern = '.R')
purrr::map(funcfiles, source)
```

---

## Package sanity

Suppose you need to load a bunch of packages and aren't sure whether they 
are installed on your system or not. You can certainly look in `installed.packages`, but if you have 1000s of packages, this can be slow.

You can use `require`:

```r
x &lt;- require(ggiraph)
x
```

```
[1] TRUE
```

A more elegant solution is using the **pacman** package


```r
if (!require("pacman")) install.packages("pacman") # make sure pacman is installed
pacman::p_load(ggiraph, stargazer, kableExtra)
```

This will install the package if it's not installed, and then load it up.

---

## Manipulate data with care
+ Keep a pristine copy of the data
+ Use scripts to manipulate data for reproducibility
    + Can catch analyst mistakes and fix
+ Systematically verify and clean
    + Create your own Standard Operating Plan
+ Document what you find
    + Lab notebook ([example](http://www.carlboettiger.info/lab-notebook.html))

---

## Manipulate data with care
+ The laws of unintended consequences are vicious and unforgiving, and appear all too frequenty at the data munging stage
+ For example, data types can change (factor to integer)
+ Test your data at each stage to make sure you still have what you think you have

---

## Track data provenance through the pipeline
+ Typically:

&gt; Raw data &gt;&gt; Intermediate data &gt;&gt; Final data &gt;&gt; data for sub-analyses &gt;&gt; data for final tables and figures

+ Catalog and track where you create data, and where you ingest it
+ Make sure there are no loops!!

---

## Share preliminary analysis for a sniff
+ Share initial explorations with colleagues so they pass a "sniff" test
    + Are data types what you expect
    + Are data ranges what you expect
    + Are distributions what you expect
    + Are relationships what you expect

--

+ This stuff is important and requires deliberate brain power
+ May require feedback loop and more thinking about the problem

---

## A general pipeline
&lt;img src="../img/tidypipeline.jpg" width="1600" /&gt;
&lt;p style="text-align:right; font-size:70%"&gt; David Robinson, 2016&lt;/p&gt;

---

## Know where final tables and figures come from
+ I create separate files for creating figures and tables for a paper
    + They're called `FinalTables.R` and `FinalFigures.R`. Duh!
+ This provides final check that right data are used, and can be updated easily during revision cycle

+ It's a long road to this point, so make sure things are good.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../../js/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLanguage": "r",
"countIncrementalSlides": false,
"highlightStyle": "tomorrow-night-bright",
"highlightLines": true,
"slideNumberFormat": "%current%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
