<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Practical R: Data Ingestion and Munging</title>
    <meta charset="utf-8" />
    <meta name="author" content="Abhijit Dasgupta" />
    <script src="03-DataIngestionMunging_files/header-attrs-2.3/header-attrs.js"></script>
    <link href="03-DataIngestionMunging_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="03-DataIngestionMunging_files/countdown-0.3.5/countdown.css" rel="stylesheet" />
    <script src="03-DataIngestionMunging_files/countdown-0.3.5/countdown.js"></script>
    <link rel="stylesheet" href="robot.css" type="text/css" />
    <link rel="stylesheet" href="robot-fonts.css" type="text/css" />
    <link rel="stylesheet" href="sfah.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Practical R: Data Ingestion and Munging
### Abhijit Dasgupta
### BIOF 339

---




layout: true

&lt;div class="my-header"&gt;
&lt;span&gt;BIOF339, BIOF 339&lt;/span&gt;&lt;/div&gt;

---

## A quick refresh

+ We talked about various data structures in R
+ The primacy of the `data.frame`
  - Extracting individual variables from a data frame
    - `breast_cancer$ER.Status`, `breast_cancer[,'ER.Status']`, `breast_cancer[['ER.Status']]`
  - Extracting rows of a `data.frame`
+ Identifying data classes using the `class` function
+ Recognizing different classes: `numeric`, `character`, `factor`, `Date`, ..
  - testing for a class: `is.numeric`
  - converting to a class: `as.numeric`

---
class: middle, center

# A note on factors

---

## Factors

+ Factors are stored internally as integers, with *meta-data* in the form of text labels
  - There is an inherent ordering of labels, by default alphabetically
+ Individual levels of a factor are treated as *separate* but related variables (dummy variables)


```r
breast_cancer &lt;- read_csv('data/clinical_data_breast_cancer_modified.csv')
names(breast_cancer) &lt;- make.names(names(breast_cancer))
breast_cancer$ER.Status.f &lt;- factor(breast_cancer$ER.Status)
summary(breast_cancer$ER.Status)
```

```
#&gt;     Length     Class      Mode 
#&gt;        105 character character
```

```r
summary(breast_cancer$ER.Status.f)
```

```
#&gt;  Indeterminate      Negative      Positive 
#&gt;              1            36            68
```

---

## Factors


```r
breast_cancer$ER.Status.f &lt;- fct_relevel(breast_cancer$ER.Status.f, 'Negative')
summary(breast_cancer$ER.Status.f)
```

```
#&gt;       Negative Indeterminate      Positive 
#&gt;             36             1            68
```

This is manipulating the meta-data, not the actual data itself

---

## Factors


```r
breast_cancer$ER.Status.n &lt;- as.numeric(breast_cancer$ER.Status.f)
summary(breast_cancer$ER.Status.n)
```

```
#&gt;     Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;    1.000   1.000   3.000   2.305   3.000   3.000
```

Logistic regression of death status on ER status

.pull-left[

```
#&gt;  # A tibble: 2 x 2
#&gt;    term        estimate
#&gt;    &lt;chr&gt;          &lt;dbl&gt;
#&gt;  1 (Intercept)    1.81 
#&gt;  2 ER.Status.n    0.148
```

Only one coefficient, since levels are modeled as numeric, with one slope being estimated
]
.pull-right[

```
#&gt;  # A tibble: 3 x 2
#&gt;    term                     estimate
#&gt;    &lt;chr&gt;                       &lt;dbl&gt;
#&gt;  1 (Intercept)                 2.08 
#&gt;  2 ER.Status.fIndeterminate  -17.6  
#&gt;  3 ER.Status.fPositive         0.256
```

One coefficient for all but one factor level
]

---

## RMarkdown tip of the day

You can add options to each R chunk to add or suppress output

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Option &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Property &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; echo=T/F &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Does the document show the R code &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; eval=T/F &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Does the chunk get evaluated by R &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; message=T/F &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Do messages get printed &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; warning=T/F &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Do warnings get printed &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

You can also set these once per session by putting the following in a R chunk:


```r
knitr::opts_chunk(echo=T, eval=T, message=F, warning=F)
```

See [here](https://yihui.name/knitr/options/#chunk-options) for the full gory details

---
class: middle, center

# Data ingestion

---

## Data ingestion

Unlike Excel, you have to pull data into R for R to operate on it

Typically your data is in some sort of file (Excel, csv, sas7bdat, dta, txt)

You need to find a way to pull it into R

The GUI you've used is one way, but not very programmatic

---

## Data ingestion

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Type &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Function &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Package &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Notes &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; read_csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; readr &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Takes care of formatting &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; read.csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; base &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Built in &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; fread &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; data.table &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Fastest &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Excel &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; read_excel &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; readxl &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; sas7bdat &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; read_sas &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; haven &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; SAS format &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; sav &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; read_spss &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; haven &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; SPSS format &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; dta &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; read_dta &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; haven &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Stata format &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# Data ingestion

We will use [this](data/BreastCancer_Clinical.csv) csv data and [this](data/BreastCancer.xlsx) Excel data for the following:


```r
brca_clinical &lt;- readr::read_csv('data/BreastCancer_Clinical.csv')
brca_clinical2 &lt;- data.table::fread('data/BreastCancer_Clinical.csv')
```

.pull-left[

```r
str(brca_clinical)
```

```
#&gt;  tibble [77 × 30] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
#&gt;   $ Complete TCGA ID                   : chr [1:77] "TCGA-A2-A0CM" "TCGA-BH-A18Q" "TCGA-A7-A0CE" "TCGA-D8-A142" ...
#&gt;   $ Gender                             : chr [1:77] "FEMALE" "FEMALE" "FEMALE" "FEMALE" ...
#&gt;   $ Age at Initial Pathologic Diagnosis: num [1:77] 40 56 57 74 61 67 45 48 59 36 ...
#&gt;   $ ER Status                          : chr [1:77] "Negative" "Negative" "Negative" "Negative" ...
#&gt;   $ PR Status                          : chr [1:77] "Negative" "Negative" "Negative" "Negative" ...
#&gt;   $ HER2 Final Status                  : chr [1:77] "Negative" "Negative" "Negative" "Negative" ...
#&gt;   $ Tumor                              : chr [1:77] "T2" "T2" "T2" "T3" ...
#&gt;   $ Tumor--T1 Coded                    : chr [1:77] "T_Other" "T_Other" "T_Other" "T_Other" ...
#&gt;   $ Node                               : chr [1:77] "N0" "N1" "N0" "N0" ...
#&gt;   $ Node-Coded                         : chr [1:77] "Negative" "Positive" "Negative" "Negative" ...
#&gt;   $ Metastasis                         : chr [1:77] "M0" "M0" "M0" "M0" ...
#&gt;   $ Metastasis-Coded                   : chr [1:77] "Negative" "Negative" "Negative" "Negative" ...
#&gt;   $ AJCC Stage                         : chr [1:77] "Stage IIA" "Stage IIB" "Stage IIA" "Stage IIB" ...
#&gt;   $ Converted Stage                    : chr [1:77] "Stage IIA" "No_Conversion" "Stage IIA" "Stage IIB" ...
#&gt;   $ Survival Data Form                 : chr [1:77] "followup" "enrollment" "followup" "followup" ...
#&gt;   $ Vital Status                       : chr [1:77] "DECEASED" "DECEASED" "LIVING" "LIVING" ...
#&gt;   $ Days to Date of Last Contact       : num [1:77] 754 1692 309 425 775 ...
#&gt;   $ Days to date of Death              : num [1:77] 754 1692 NA NA NA ...
#&gt;   $ OS event                           : num [1:77] 1 1 0 0 0 0 0 0 0 0 ...
#&gt;   $ OS Time                            : num [1:77] 754 1692 309 425 775 ...
#&gt;   $ PAM50 mRNA                         : chr [1:77] "Basal-like" "Basal-like" "Basal-like" "Basal-like" ...
#&gt;   $ SigClust Unsupervised mRNA         : num [1:77] -12 -12 0 0 -12 -12 -12 -12 0 0 ...
#&gt;   $ SigClust Intrinsic mRNA            : num [1:77] -13 -13 -13 -13 -13 -13 -13 -13 -13 -13 ...
#&gt;   $ miRNA Clusters                     : num [1:77] 4 5 5 3 2 5 4 4 5 5 ...
#&gt;   $ methylation Clusters               : num [1:77] 4 5 5 5 5 5 5 5 5 5 ...
#&gt;   $ RPPA Clusters                      : chr [1:77] "Basal" "Basal" "Basal" "X" ...
#&gt;   $ CN Clusters                        : num [1:77] 4 1 1 1 1 3 3 1 3 1 ...
#&gt;   $ Integrated Clusters (with PAM50)   : num [1:77] 2 2 2 2 2 2 2 2 2 2 ...
#&gt;   $ Integrated Clusters (no exp)       : num [1:77] 1 2 2 2 2 2 2 2 2 2 ...
#&gt;   $ Integrated Clusters (unsup exp)    : num [1:77] 1 2 2 2 2 2 2 2 2 2 ...
#&gt;   - attr(*, "spec")=
#&gt;    .. cols(
#&gt;    ..   `Complete TCGA ID` = col_character(),
#&gt;    ..   Gender = col_character(),
#&gt;    ..   `Age at Initial Pathologic Diagnosis` = col_double(),
#&gt;    ..   `ER Status` = col_character(),
#&gt;    ..   `PR Status` = col_character(),
#&gt;    ..   `HER2 Final Status` = col_character(),
#&gt;    ..   Tumor = col_character(),
#&gt;    ..   `Tumor--T1 Coded` = col_character(),
#&gt;    ..   Node = col_character(),
#&gt;    ..   `Node-Coded` = col_character(),
#&gt;    ..   Metastasis = col_character(),
#&gt;    ..   `Metastasis-Coded` = col_character(),
#&gt;    ..   `AJCC Stage` = col_character(),
#&gt;    ..   `Converted Stage` = col_character(),
#&gt;    ..   `Survival Data Form` = col_character(),
#&gt;    ..   `Vital Status` = col_character(),
#&gt;    ..   `Days to Date of Last Contact` = col_double(),
#&gt;    ..   `Days to date of Death` = col_double(),
#&gt;    ..   `OS event` = col_double(),
#&gt;    ..   `OS Time` = col_double(),
#&gt;    ..   `PAM50 mRNA` = col_character(),
#&gt;    ..   `SigClust Unsupervised mRNA` = col_double(),
#&gt;    ..   `SigClust Intrinsic mRNA` = col_double(),
#&gt;    ..   `miRNA Clusters` = col_double(),
#&gt;    ..   `methylation Clusters` = col_double(),
#&gt;    ..   `RPPA Clusters` = col_character(),
#&gt;    ..   `CN Clusters` = col_double(),
#&gt;    ..   `Integrated Clusters (with PAM50)` = col_double(),
#&gt;    ..   `Integrated Clusters (no exp)` = col_double(),
#&gt;    ..   `Integrated Clusters (unsup exp)` = col_double()
#&gt;    .. )
```
]
.pull-right[

```r
str(brca_clinical2)
```

```
#&gt;  Classes 'data.table' and 'data.frame':	77 obs. of  30 variables:
#&gt;   $ Complete TCGA ID                   : chr  "TCGA-A2-A0CM" "TCGA-BH-A18Q" "TCGA-A7-A0CE" "TCGA-D8-A142" ...
#&gt;   $ Gender                             : chr  "FEMALE" "FEMALE" "FEMALE" "FEMALE" ...
#&gt;   $ Age at Initial Pathologic Diagnosis: int  40 56 57 74 61 67 45 48 59 36 ...
#&gt;   $ ER Status                          : chr  "Negative" "Negative" "Negative" "Negative" ...
#&gt;   $ PR Status                          : chr  "Negative" "Negative" "Negative" "Negative" ...
#&gt;   $ HER2 Final Status                  : chr  "Negative" "Negative" "Negative" "Negative" ...
#&gt;   $ Tumor                              : chr  "T2" "T2" "T2" "T3" ...
#&gt;   $ Tumor--T1 Coded                    : chr  "T_Other" "T_Other" "T_Other" "T_Other" ...
#&gt;   $ Node                               : chr  "N0" "N1" "N0" "N0" ...
#&gt;   $ Node-Coded                         : chr  "Negative" "Positive" "Negative" "Negative" ...
#&gt;   $ Metastasis                         : chr  "M0" "M0" "M0" "M0" ...
#&gt;   $ Metastasis-Coded                   : chr  "Negative" "Negative" "Negative" "Negative" ...
#&gt;   $ AJCC Stage                         : chr  "Stage IIA" "Stage IIB" "Stage IIA" "Stage IIB" ...
#&gt;   $ Converted Stage                    : chr  "Stage IIA" "No_Conversion" "Stage IIA" "Stage IIB" ...
#&gt;   $ Survival Data Form                 : chr  "followup" "enrollment" "followup" "followup" ...
#&gt;   $ Vital Status                       : chr  "DECEASED" "DECEASED" "LIVING" "LIVING" ...
#&gt;   $ Days to Date of Last Contact       : int  754 1692 309 425 775 964 1027 1288 1319 1471 ...
#&gt;   $ Days to date of Death              : num  754 1692 NA NA NA ...
#&gt;   $ OS event                           : int  1 1 0 0 0 0 0 0 0 0 ...
#&gt;   $ OS Time                            : int  754 1692 309 425 775 964 1027 1288 1319 1471 ...
#&gt;   $ PAM50 mRNA                         : chr  "Basal-like" "Basal-like" "Basal-like" "Basal-like" ...
#&gt;   $ SigClust Unsupervised mRNA         : int  -12 -12 0 0 -12 -12 -12 -12 0 0 ...
#&gt;   $ SigClust Intrinsic mRNA            : int  -13 -13 -13 -13 -13 -13 -13 -13 -13 -13 ...
#&gt;   $ miRNA Clusters                     : int  4 5 5 3 2 5 4 4 5 5 ...
#&gt;   $ methylation Clusters               : int  4 5 5 5 5 5 5 5 5 5 ...
#&gt;   $ RPPA Clusters                      : chr  "Basal" "Basal" "Basal" "X" ...
#&gt;   $ CN Clusters                        : int  4 1 1 1 1 3 3 1 3 1 ...
#&gt;   $ Integrated Clusters (with PAM50)   : int  2 2 2 2 2 2 2 2 2 2 ...
#&gt;   $ Integrated Clusters (no exp)       : int  1 2 2 2 2 2 2 2 2 2 ...
#&gt;   $ Integrated Clusters (unsup exp)    : int  1 2 2 2 2 2 2 2 2 2 ...
#&gt;   - attr(*, ".internal.selfref")=&lt;externalptr&gt;
```
]

---

## A note on two "super"-data.frame objects

.pull-left[
A `tibble`

```
#&gt;  # A tibble: 6 x 30
#&gt;    `Complete TCGA … Gender `Age at Initial… `ER Status` `PR Status`
#&gt;    &lt;chr&gt;            &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      
#&gt;  1 TCGA-A2-A0CM     FEMALE               40 Negative    Negative   
#&gt;  2 TCGA-BH-A18Q     FEMALE               56 Negative    Negative   
#&gt;  3 TCGA-A7-A0CE     FEMALE               57 Negative    Negative   
#&gt;  4 TCGA-D8-A142     FEMALE               74 Negative    Negative   
#&gt;  5 TCGA-AO-A0J6     FEMALE               61 Negative    Negative   
#&gt;  6 TCGA-A2-A0YM     FEMALE               67 Negative    Negative   
#&gt;  # … with 25 more variables: `HER2 Final Status` &lt;chr&gt;, Tumor &lt;chr&gt;, `Tumor--T1
#&gt;  #   Coded` &lt;chr&gt;, Node &lt;chr&gt;, `Node-Coded` &lt;chr&gt;, Metastasis &lt;chr&gt;,
#&gt;  #   `Metastasis-Coded` &lt;chr&gt;, `AJCC Stage` &lt;chr&gt;, `Converted Stage` &lt;chr&gt;,
#&gt;  #   `Survival Data Form` &lt;chr&gt;, `Vital Status` &lt;chr&gt;, `Days to Date of Last
#&gt;  #   Contact` &lt;dbl&gt;, `Days to date of Death` &lt;dbl&gt;, `OS event` &lt;dbl&gt;, `OS
#&gt;  #   Time` &lt;dbl&gt;, `PAM50 mRNA` &lt;chr&gt;, `SigClust Unsupervised mRNA` &lt;dbl&gt;,
#&gt;  #   `SigClust Intrinsic mRNA` &lt;dbl&gt;, `miRNA Clusters` &lt;dbl&gt;, `methylation
#&gt;  #   Clusters` &lt;dbl&gt;, `RPPA Clusters` &lt;chr&gt;, `CN Clusters` &lt;dbl&gt;, `Integrated
#&gt;  #   Clusters (with PAM50)` &lt;dbl&gt;, `Integrated Clusters (no exp)` &lt;dbl&gt;,
#&gt;  #   `Integrated Clusters (unsup exp)` &lt;dbl&gt;
```
]
.pull-right[
A `data.table`


```
#&gt;     Complete TCGA ID Gender Age at Initial Pathologic Diagnosis ER Status
#&gt;  1:     TCGA-A2-A0CM FEMALE                                  40  Negative
#&gt;  2:     TCGA-BH-A18Q FEMALE                                  56  Negative
#&gt;  3:     TCGA-A7-A0CE FEMALE                                  57  Negative
#&gt;  4:     TCGA-D8-A142 FEMALE                                  74  Negative
#&gt;  5:     TCGA-AO-A0J6 FEMALE                                  61  Negative
#&gt;  6:     TCGA-A2-A0YM FEMALE                                  67  Negative
#&gt;     PR Status HER2 Final Status Tumor Tumor--T1 Coded Node Node-Coded Metastasis
#&gt;  1:  Negative          Negative    T2         T_Other   N0   Negative         M0
#&gt;  2:  Negative          Negative    T2         T_Other   N1   Positive         M0
#&gt;  3:  Negative          Negative    T2         T_Other   N0   Negative         M0
#&gt;  4:  Negative          Negative    T3         T_Other   N0   Negative         M0
#&gt;  5:  Negative          Negative    T2         T_Other   N0   Negative         M0
#&gt;  6:  Negative          Negative    T2         T_Other   N0   Negative         M0
#&gt;     Metastasis-Coded AJCC Stage Converted Stage Survival Data Form Vital Status
#&gt;  1:         Negative  Stage IIA       Stage IIA           followup     DECEASED
#&gt;  2:         Negative  Stage IIB   No_Conversion         enrollment     DECEASED
#&gt;  3:         Negative  Stage IIA       Stage IIA           followup       LIVING
#&gt;  4:         Negative  Stage IIB       Stage IIB           followup       LIVING
#&gt;  5:         Negative  Stage IIA       Stage IIA           followup       LIVING
#&gt;  6:         Negative  Stage IIA       Stage IIA           followup       LIVING
#&gt;     Days to Date of Last Contact Days to date of Death OS event OS Time
#&gt;  1:                          754                   754        1     754
#&gt;  2:                         1692                  1692        1    1692
#&gt;  3:                          309                    NA        0     309
#&gt;  4:                          425                    NA        0     425
#&gt;  5:                          775                    NA        0     775
#&gt;  6:                          964                    NA        0     964
#&gt;     PAM50 mRNA SigClust Unsupervised mRNA SigClust Intrinsic mRNA miRNA Clusters
#&gt;  1: Basal-like                        -12                     -13              4
#&gt;  2: Basal-like                        -12                     -13              5
#&gt;  3: Basal-like                          0                     -13              5
#&gt;  4: Basal-like                          0                     -13              3
#&gt;  5: Basal-like                        -12                     -13              2
#&gt;  6: Basal-like                        -12                     -13              5
#&gt;     methylation Clusters RPPA Clusters CN Clusters
#&gt;  1:                    4         Basal           4
#&gt;  2:                    5         Basal           1
#&gt;  3:                    5         Basal           1
#&gt;  4:                    5             X           1
#&gt;  5:                    5         Basal           1
#&gt;  6:                    5         Basal           3
#&gt;     Integrated Clusters (with PAM50) Integrated Clusters (no exp)
#&gt;  1:                                2                            1
#&gt;  2:                                2                            2
#&gt;  3:                                2                            2
#&gt;  4:                                2                            2
#&gt;  5:                                2                            2
#&gt;  6:                                2                            2
#&gt;     Integrated Clusters (unsup exp)
#&gt;  1:                               1
#&gt;  2:                               2
#&gt;  3:                               2
#&gt;  4:                               2
#&gt;  5:                               2
#&gt;  6:                               2
```
]

---

## A note on two "super"-data.frame objects

+ A `tibble` works pretty much like any `data.frame`, but the printing is a little saner
+ A `data.table` is faster, has more inherent functionality, but has a ver different syntax

We'll work almost entirely with `tibble`'s and not `data.table`

--

Suggested modifications:

+ If using `fread`, convert the resulting object to a `data.frame` or `tibble` using `as_data_frame()` or `as_tibble`
+ Convert the column names to not have spaces using, for example,


```r
names(brca_clinical) &lt;- make.names(names(brca_clinical))
```

---

## Data ingestion

Note that you **have** to give a name to what you're importing using `read_*` or whatever you're using, otherwise it won't stay in R


```r
brca_clinical &lt;- readr::read_csv('data/BreastCancer_Clinical.csv')
```

![](img/env.png)

---

## Reading Excel


```r
readxl::excel_sheets('data/BreastCancer.xlsx')
```

```
#&gt;  [1] "Cllinical"  "Expression"
```

```r
brca_expression &lt;- readxl::read_excel('data/BreastCancer.xlsx', sheet='Expression')
```

---
class: middle, center

# Data export

---

## Data export

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Type &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Function &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Package &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Notes &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; write_csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; readr &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Takes care of formatting &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; write.csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; base &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Built in &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; csv &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; fwrite &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; data.table &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Fastest &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Excel &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; write.xlsx &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; openxlsx &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; sas7bdat &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; write_sas &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; haven &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; SAS format &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; sav &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; write_spss &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; haven &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; SPSS format &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; dta &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; write_dta &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; haven &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Stata format &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

We'll often save tabular results using these functions

---

## Simplifying import/export

We'll be using a package that makes this easier. 

It's called `rio` and it has two basic functions: `import` and `export`.

The `rio` package uses the different packages mentioned earlier but unifies it into a single syntax

### Classwork

Open an Rmd file, and create a R chunk where you use the function `import` from `rio` to 
load the clinical breast cancer data into R

- Note, you have to "activate" the `rio` package in the chunk
- You have to save the imported object by giving it a name

<div class="countdown" id="timer_5f558d7a" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: middle, center

# Data munging

---
---
class: middle, center

# The tidyverse

---

## What is the tidyverse?

&gt; The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. -- Dr. Hadley Wickham

- A human-friendly syntax and semantics to make code more understandable
- The functions in the tidyverse often wraps harder-to-understand functions into simpler, more understandable forms
- We're taking an opinionated choice here
    - Covers maybe 85% of the cases you'll ever face
    - Takes a particular viewpoint about how data _should_ be organized
- But this makes things easier and simpler

---

## What's tidy here?

The way data is organized in a data frame is __tidy__ in this framework.

1. Each variable must have its own column.
1. Each observation must have its own row.
1. Each value must have its own cell.

--

In practical terms:

1. Put data in a data frame / _tibble_
1. Make sure each variable is in its own column

---

## Tidy data

A first step in the tidyverse is to activate the `tidyverse` meta-package


```r
library(tidyverse)
```

&lt;font size=5&gt;
.pull-left[

```
#&gt;  
#&gt;  Attaching package: 'glue'
```

```
#&gt;  The following object is masked from 'package:dplyr':
#&gt;  
#&gt;      collapse
```

- [**ggplot2**](http://ggplot2.tidyverse.org): Create Elegant Data Visualisations Using the Grammar of Graphics
- [**purrr**](http://purrr.tidyverse.org): Functional Programming Tools
- [**readr**](http://readr.tidyverse.org): Read Rectangular Text Data
- [**tidyr**](http://tidyr.tidyverse.org): Tidy Messy Data
]
.pull-right[
- [**dplyr**](http://dplyr.tidyverse.org): A Grammar of Data Manipulation
- [**forcats**](http://forcats.tidyverse.org): Tools for Working with Categorical Variables (Factors)
- [**lubridate**](http://lubridate.tidyverse.org): Make Dealing with Dates a Little Easier
- [**stringr**](http://stringr.tidyverse.org): Simple, Consistent Wrappers for Common String Operations
]
&lt;/font&gt;

---

## Tidy data

The common feature of all these packages is that their functions take a 
data frame (which the tidyverse calls a `tibble`) as their first argument.

So the starting point for any analysis is the data set.

---

## Tidy data


```r
table1
```

```
#&gt;  # A tibble: 6 x 4
#&gt;    country      year  cases population
#&gt;    &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
#&gt;  1 Afghanistan  1999    745   19987071
#&gt;  2 Afghanistan  2000   2666   20595360
#&gt;  3 Brazil       1999  37737  172006362
#&gt;  4 Brazil       2000  80488  174504898
#&gt;  5 China        1999 212258 1272915272
#&gt;  6 China        2000 213766 1280428583
```

Is this tidy?

---

## Tidy data


```r
table2
```

```
#&gt;  # A tibble: 12 x 4
#&gt;     country      year type            count
#&gt;     &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
#&gt;   1 Afghanistan  1999 cases             745
#&gt;   2 Afghanistan  1999 population   19987071
#&gt;   3 Afghanistan  2000 cases            2666
#&gt;   4 Afghanistan  2000 population   20595360
#&gt;   5 Brazil       1999 cases           37737
#&gt;   6 Brazil       1999 population  172006362
#&gt;   7 Brazil       2000 cases           80488
#&gt;   8 Brazil       2000 population  174504898
#&gt;   9 China        1999 cases          212258
#&gt;  10 China        1999 population 1272915272
#&gt;  11 China        2000 cases          213766
#&gt;  12 China        2000 population 1280428583
```

Is this tidy?

---

## Tidy data


```r
table3
```

```
#&gt;  # A tibble: 6 x 3
#&gt;    country      year rate             
#&gt;  * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
#&gt;  1 Afghanistan  1999 745/19987071     
#&gt;  2 Afghanistan  2000 2666/20595360    
#&gt;  3 Brazil       1999 37737/172006362  
#&gt;  4 Brazil       2000 80488/174504898  
#&gt;  5 China        1999 212258/1272915272
#&gt;  6 China        2000 213766/1280428583
```

Is this tidy?

---


## Tidy data


```r
table4a # cases
```

```
#&gt;  # A tibble: 3 x 3
#&gt;    country     `1999` `2000`
#&gt;  * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
#&gt;  1 Afghanistan    745   2666
#&gt;  2 Brazil       37737  80488
#&gt;  3 China       212258 213766
```

```r
table4b # population
```

```
#&gt;  # A tibble: 3 x 3
#&gt;    country         `1999`     `2000`
#&gt;  * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;
#&gt;  1 Afghanistan   19987071   20595360
#&gt;  2 Brazil       172006362  174504898
#&gt;  3 China       1272915272 1280428583
```

Are these tidy?

---

## Can we make datasets tidy?

Sometimes. The functions in the `tidyr` package can help

- `separate` is a function that can split a column into multiple columns
    - When there are multiple variables together in a column
    

```r
table3
```

```
#&gt;  # A tibble: 6 x 3
#&gt;    country      year rate             
#&gt;  * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
#&gt;  1 Afghanistan  1999 745/19987071     
#&gt;  2 Afghanistan  2000 2666/20595360    
#&gt;  3 Brazil       1999 37737/172006362  
#&gt;  4 Brazil       2000 80488/174504898  
#&gt;  5 China        1999 212258/1272915272
#&gt;  6 China        2000 213766/1280428583
```

We need to separate `rate` into two variables, cases and population

---



## Can we make datasets tidy?


```r
separate(table3, col = rate, into = c("cases", "population"), 
         sep = "/")
```

```
#&gt;  # A tibble: 6 x 4
#&gt;    country      year cases  population
#&gt;    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
#&gt;  1 Afghanistan  1999 745    19987071  
#&gt;  2 Afghanistan  2000 2666   20595360  
#&gt;  3 Brazil       1999 37737  172006362 
#&gt;  4 Brazil       2000 80488  174504898 
#&gt;  5 China        1999 212258 1272915272
#&gt;  6 China        2000 213766 1280428583
```

&gt; I've been explicit about naming all the options. R functions can work by 
position as well, so `separate(table3, rate, c('cases','population'), '/')` would work, but it's not very clear, is it?

---

## Can we make datasets tidy?


```r
table2
```

```
#&gt;  # A tibble: 12 x 4
#&gt;     country      year type            count
#&gt;     &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
#&gt;   1 Afghanistan  1999 cases             745
#&gt;   2 Afghanistan  1999 population   19987071
#&gt;   3 Afghanistan  2000 cases            2666
#&gt;   4 Afghanistan  2000 population   20595360
#&gt;   5 Brazil       1999 cases           37737
#&gt;   6 Brazil       1999 population  172006362
#&gt;   7 Brazil       2000 cases           80488
#&gt;   8 Brazil       2000 population  174504898
#&gt;   9 China        1999 cases          212258
#&gt;  10 China        1999 population 1272915272
#&gt;  11 China        2000 cases          213766
#&gt;  12 China        2000 population 1280428583
```

Here there are observations on two variables in successive rows

---

## Can we make datasets tidy?

We need to `spread` these rows out into different columns

.pull-left[

```r
spread(table2, key = type, value = count)
```

```
#&gt;  # A tibble: 6 x 4
#&gt;    country      year  cases population
#&gt;    &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
#&gt;  1 Afghanistan  1999    745   19987071
#&gt;  2 Afghanistan  2000   2666   20595360
#&gt;  3 Brazil       1999  37737  172006362
#&gt;  4 Brazil       2000  80488  174504898
#&gt;  5 China        1999 212258 1272915272
#&gt;  6 China        2000 213766 1280428583
```
]
.pull-right[
![](img/spread.png)
]

---

## Can we make datasets tidy?


```r
table4a
```

```
#&gt;  # A tibble: 3 x 3
#&gt;    country     `1999` `2000`
#&gt;  * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
#&gt;  1 Afghanistan    745   2666
#&gt;  2 Brazil       37737  80488
#&gt;  3 China       212258 213766
```

Here, the variable for year is stored as a header, not as data in a cell.

We need to `gather` that data and put it into a column

---

## Can we make datasets tidy?

.pull-left[

```r
tidyr::gather(table4a, key = year, value = cases, `1999`, `2000`)
```

```
#&gt;  # A tibble: 6 x 3
#&gt;    country     year   cases
#&gt;    &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
#&gt;  1 Afghanistan 1999     745
#&gt;  2 Brazil      1999   37737
#&gt;  3 China       1999  212258
#&gt;  4 Afghanistan 2000    2666
#&gt;  5 Brazil      2000   80488
#&gt;  6 China       2000  213766
```
]
.pull-right[
![](img/gather.png)
]

---

## Making data tidy

Admittedly, `spread` and `gather` are not easy concepts, but we'll practice with them more. 

1. `gather` collects multiple columns into 2, and only 2 columns
    - One column represents the data in the column headers
    - One column represents the values in the column
    - All other columns are repeated to keep all the data properly associated
1. `spread` takes two columns and makes them multiple columns
    - The values in one column form the headers to different new columns
    - The values in the other column represent the values in the corresponding cells
    - The other columns are repeated to start with, but reduce repetitions to make all associated data stay together
    
---

## Progress check

Load the data from [this link](data/pew.csv). You can look the structure by `head(____)` where `___` is what you named the dataset. 

What do you think you would need to do to make this data tidy? (Hint: look at the column headers)

<div class="countdown" id="timer_5f558e9b" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

--

What function would you want to use?

--

Fill in the blanks:


```r
gather(______, key = _____, value = ________, ______,______,_______,
             _______,________,_________,__________,__________,____)
```

--

This is a lot of writing. There's gotta be something simpler

---

## A friendly way of selecting columns

The tidyverse gives us a nice way of selecting, or not selecting columns

Instead of all the writing, we could simply say


```r
pew &lt;- read_csv('data/pew.csv')
tidyr::gather(pew, key = income, value = count, -religion)
```

--


```
#&gt;  # A tibble: 180 x 3
#&gt;     religion                income count
#&gt;     &lt;chr&gt;                   &lt;chr&gt;  &lt;dbl&gt;
#&gt;   1 Agnostic                &lt;$10k     27
#&gt;   2 Atheist                 &lt;$10k     12
#&gt;   3 Buddhist                &lt;$10k     27
#&gt;   4 Catholic                &lt;$10k    418
#&gt;   5 Don’t know/refused      &lt;$10k     15
#&gt;   6 Evangelical Prot        &lt;$10k    575
#&gt;   7 Hindu                   &lt;$10k      1
#&gt;   8 Historically Black Prot &lt;$10k    228
#&gt;   9 Jehovah's Witness       &lt;$10k     20
#&gt;  10 Jewish                  &lt;$10k     19
#&gt;  # … with 170 more rows
```

---

## `dplyr` verbs in the tidyverse

The `dplyr` package gives us a few verbs for data manipulation


|Function  |Purpose                                        |
|:---------|:----------------------------------------------|
|select    |Select columns based on name or position       |
|mutate    |Create or change a column                      |
|filter    |Extract rows based on some criteria            |
|arrange   |Re-order rows based on values of variable(s)   |
|group_by  |Split a dataset by unique values of a variable |
|summarize |Create summary statistics based on columns     |

---

## `select`

You can select columns by name or position, of course. 

You can also select columns based on some criteria, which are encapsulated in functions.

- starts_with("___"), ends_with("___"), contains("____")
- one_of("____","_____","______")

There are others; see `help(starts_with)`.

---

## Example

Load [this file](data/weather.csv). This contains daily temperature data in 2010 for some location.


```r
weather &lt;- rio::import('data/weather.csv')
# weather &lt;- readr::read_csv(here::here('slides','lectures','data','FSI','weather.csv'))
```

```r
head(weather, 2)
```

```
#&gt;         id year month element d1 d2 d3 d4 d5 d6 d7 d8 d9 d10 d11 d12 d13 d14 d15
#&gt;  1 MX17004 2010     1    tmax NA NA NA NA NA NA NA NA NA  NA  NA  NA  NA  NA  NA
#&gt;  2 MX17004 2010     1    tmin NA NA NA NA NA NA NA NA NA  NA  NA  NA  NA  NA  NA
#&gt;    d16 d17 d18 d19 d20 d21 d22 d23 d24 d25 d26 d27 d28 d29  d30 d31
#&gt;  1  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA 27.8  NA
#&gt;  2  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA 14.5  NA
```

How would you just select the columns with the daily data?

--


```r
select(weather, starts_with("d"))
```

---

## mutate

`mutate` can either transform a column in place or create a new column in a dataset

We'll use the in-built `mpg` dataset for this example, We'll select only the city and highway mileages. To use this selection later, we will need to assign it to a new name


```r
mpg1 &lt;- select(mpg, cty, hwy)
```

---

## mutate

We'll change the city and highway mileage to km/l from mpg. This will involve multiplying it by 1.6 and dividing by 3.8

.pull-left[

```r
mutate(mpg1, cty = cty * 1.6 / 3.8, hwy = hwy * 1.6/3.8)
```

```
#&gt;  # A tibble: 234 x 2
#&gt;       cty   hwy
#&gt;     &lt;dbl&gt; &lt;dbl&gt;
#&gt;   1  7.58  12.2
#&gt;   2  8.84  12.2
#&gt;   3  8.42  13.1
#&gt;   4  8.84  12.6
#&gt;   5  6.74  10.9
#&gt;   6  7.58  10.9
#&gt;   7  7.58  11.4
#&gt;   8  7.58  10.9
#&gt;   9  6.74  10.5
#&gt;  10  8.42  11.8
#&gt;  # … with 224 more rows
```
This is in-place replacement
]
.pull-right[

```r
mutate(mpg1, cty1 = cty * 1.6/3.8, hwy1 = hwy * 1.6/3.8)
```

```
#&gt;  # A tibble: 234 x 4
#&gt;       cty   hwy  cty1  hwy1
#&gt;     &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;   1    18    29  7.58  12.2
#&gt;   2    21    29  8.84  12.2
#&gt;   3    20    31  8.42  13.1
#&gt;   4    21    30  8.84  12.6
#&gt;   5    16    26  6.74  10.9
#&gt;   6    18    26  7.58  10.9
#&gt;   7    18    27  7.58  11.4
#&gt;   8    18    26  7.58  10.9
#&gt;   9    16    25  6.74  10.5
#&gt;  10    20    28  8.42  11.8
#&gt;  # … with 224 more rows
```
This creates new variables
]

---

## filter

`filter` extracts rows based on criteria


```r
filter(mpg, cyl == 4)
```

```
#&gt;  # A tibble: 81 x 11
#&gt;     manufacturer model    displ  year   cyl trans   drv     cty   hwy fl    class
#&gt;     &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
#&gt;   1 audi         a4         1.8  1999     4 auto(l… f        18    29 p     comp…
#&gt;   2 audi         a4         1.8  1999     4 manual… f        21    29 p     comp…
#&gt;   3 audi         a4         2    2008     4 manual… f        20    31 p     comp…
#&gt;   4 audi         a4         2    2008     4 auto(a… f        21    30 p     comp…
#&gt;   5 audi         a4 quat…   1.8  1999     4 manual… 4        18    26 p     comp…
#&gt;   6 audi         a4 quat…   1.8  1999     4 auto(l… 4        16    25 p     comp…
#&gt;   7 audi         a4 quat…   2    2008     4 manual… 4        20    28 p     comp…
#&gt;   8 audi         a4 quat…   2    2008     4 auto(s… 4        19    27 p     comp…
#&gt;   9 chevrolet    malibu     2.4  1999     4 auto(l… f        19    27 r     mids…
#&gt;  10 chevrolet    malibu     2.4  2008     4 auto(l… f        22    30 r     mids…
#&gt;  # … with 71 more rows
```

This extracts only 4 cylinder vehicles

--

Other choices might be `cyl != 4`, `cyl &gt; 4`, `year == 1999`, `manufacturer=="audi"`

---

## Exercise

We already saw the weather data. It's not tidy. Let's work to make it tidy.


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLanguage": "r",
"countIncrementalSlides": false,
"highlightStyle": "tomorrow-night-bright",
"highlightLines": true,
"slideNumberFormat": "%current%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
