<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Displaying analytic results</title>
    <meta charset="utf-8" />
    <meta name="author" content="Abhijit Dasgupta" />
    <script src="01_vis_analytics_files/header-attrs/header-attrs.js"></script>
    <link href="01_vis_analytics_files/remark-css/default.css" rel="stylesheet" />
    <link href="01_vis_analytics_files/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="01_vis_analytics_files/panelset/panelset.css" rel="stylesheet" />
    <script src="01_vis_analytics_files/panelset/panelset.js"></script>
    <link href="01_vis_analytics_files/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="01_vis_analytics_files/clipboard/clipboard.min.js"></script>
    <link href="01_vis_analytics_files/shareon/shareon.min.css" rel="stylesheet" />
    <script src="01_vis_analytics_files/shareon/shareon.min.js"></script>
    <link href="01_vis_analytics_files/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="01_vis_analytics_files/xaringanExtra-shareagain/shareagain.js"></script>
    <script src="01_vis_analytics_files/kePrint/kePrint.js"></script>
    <link href="01_vis_analytics_files/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../css/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="../../css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../css/sfah.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Displaying analytic results
### Abhijit Dasgupta
### BIOF 339

---












class: middle,center,inverse

# Comparing groups

---
layout: true

## The `ggpubr` package

---

The **ggpubr** package, which extends **ggplot2** functionality, has several 
functions that allow the computation and visualization of different statistical analyses

Under the hood, it's just fancy application of R for statistical tests and then 
translating the results to ggplot geometries.

---

.pull-left[

```r
plt &lt;- ggboxplot(penguins,
          x = 'species',
          y = 'body_mass_g',
          color = 'species',
          add='jitter',
          add.params = list(color='grey', size=0.5))
summary.stats &lt;- penguins %&gt;% 
  select(body_mass_g, species) %&gt;% 
  group_by(species) %&gt;% 
  get_summary_stats(type='common')
plt2 &lt;- ggsummarytable(
  summary.stats, x = 'species', y = c('n','median','iqr')
) + 
    theme_minimal()+
    theme(panel.grid=element_blank(),
          axis.text.x = element_blank())+
    labs(x='', y='')
ggarrange(plt, plt2, ncol=1, heights=c(3,1))
```
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-1-1.png)&lt;!-- --&gt;

]

---

.pull-left[

```r
(plt &lt;- ggplot(penguins,
              aes(x=species,
                  y=body_mass_g,
                  color=species))+
  geom_boxplot()+
  geom_jitter(color='grey', size=0.5)+
  theme_classic()+
  theme(legend.position = 'top'))
```
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-2-1.png)&lt;!-- --&gt;

]

---

.pull-left[

```r
(plt &lt;- ggplot(penguins,
              aes(x=species,
                  y=body_mass_g,
                  color=species))+
  geom_boxplot()+
  geom_jitter(color='grey', size=0.5)+
  theme_classic()+
  theme(legend.position = 'top'))
```


```r
summary.stats &lt;- penguins %&gt;% 
  select(body_mass_g, species) %&gt;% 
  group_by(species) %&gt;% 
  get_summary_stats(type='common')
(plt2 &lt;- ggsummarytable(
  summary.stats, x = 'species', 
  y = c('n','median','iqr'),
  color='species'
  ) + 
    theme_minimal()+
    theme(panel.grid=element_blank(),
          axis.text.x = element_blank())+
    labs(x='', y=''))
```

]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;

]

---

.pull-left[

```r
(plt &lt;- ggplot(penguins,
              aes(x=species,
                  y=body_mass_g,
                  color=species))+
  geom_boxplot()+
  geom_jitter(color='grey', size=0.5)+
  theme_classic()+
  theme(legend.position = 'top'))
```

```r
summary.stats &lt;- penguins %&gt;% 
  select(body_mass_g, species) %&gt;% 
  group_by(species) %&gt;% 
  get_summary_stats(type='common')
(plt2 &lt;- ggsummarytable(
  summary.stats, x = 'species', 
  y = c('n','median','iqr'),
  color='species'
  ) + 
    theme_minimal()+
    theme(panel.grid=element_blank(),
          axis.text.x = element_blank())+
    labs(x='', y=''))
```



]
.pull-right[

```r
ggarrange(plt, plt2, ncol=1, heights = c(4,1))
```

![](01_vis_analytics_files/figure-html/box3-1.png)&lt;!-- --&gt;
]

---

.pull-left[

```r
(summ_plt &lt;- ggsummarystats(
  penguins,
  x = 'species',
  y = 'body_mass_g',
  ggfunc = ggboxplot, add='jitter',
  color='species',
  add.params=list(color='grey', size=0.5)
))
```
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;
]

---

.pull-left[

```r
(summ_plt &lt;- ggsummarystats(
  penguins,
  x = 'species',
  y = 'body_mass_g',
  ggfunc = ggboxplot, add='jitter',
  color='species',
  add.params=list(color='grey', size=0.5)
))
```


```r
my_comparisons &lt;- list(c('Adelie','Chinstrap'),
                       c('Chinstrap','Gentoo'),
                       c('Adelie','Gentoo'))
summ_plt$main.plot &lt;- summ_plt$main.plot + 
  stat_compare_means(comparisons = my_comparisons)+
  stat_compare_means(label.y = 8000)
summ_plt
```

-----
You can also add facets using the argument `facet.by` in `ggsummarystats`
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;
]

---



count: false
 
Scatter plots
.panel1-corr-auto[

```r
*ggscatter(penguins,
*         x = 'bill_length_mm',
*         y = 'body_mass_g',
*         color='grey',
*         add='reg.line',
*         add.params=list(color='blue'))
```
]
 
.panel2-corr-auto[
![](01_vis_analytics_files/figure-html/corr_auto_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
Scatter plots
.panel1-corr-auto[

```r
ggscatter(penguins,
          x = 'bill_length_mm',
          y = 'body_mass_g',
          color='grey',
          add='reg.line',
          add.params=list(color='blue')) +
* labs(x = 'Bill length (mm)',
*      y = 'Body mass (g)')
```
]
 
.panel2-corr-auto[
![](01_vis_analytics_files/figure-html/corr_auto_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
Scatter plots
.panel1-corr-auto[

```r
ggscatter(penguins,
          x = 'bill_length_mm',
          y = 'body_mass_g',
          color='grey',
          add='reg.line',
          add.params=list(color='blue')) +
  labs(x = 'Bill length (mm)',
       y = 'Body mass (g)') +
* stat_cor( label.x=30, label.y=6000,
*           label.sep='\n')
```
]
 
.panel2-corr-auto[
![](01_vis_analytics_files/figure-html/corr_auto_03_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
Scatter plots
.panel1-corr-auto[

```r
ggscatter(penguins,
          x = 'bill_length_mm',
          y = 'body_mass_g',
          color='grey',
          add='reg.line',
          add.params=list(color='blue')) +
  labs(x = 'Bill length (mm)',
       y = 'Body mass (g)') +
  stat_cor( label.x=30, label.y=6000,
            label.sep='\n') +
* facet_wrap(~species)
```
]
 
.panel2-corr-auto[
![](01_vis_analytics_files/figure-html/corr_auto_04_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-corr-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-corr-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-corr-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

### Add tables to a graphic

.pull-left[

```r
library(ggsci) # Themes for science journals
dens_plt &lt;- ggplot(penguins, 
                   aes(x = body_mass_g))+
  geom_density(aes(fill=species))+
  scale_fill_jco(alpha=0.3)+  # Journal of Clinical Oncology colors
  theme_classic() +
  theme(axis.text.y = element_blank(),
        legend.position='top') +
  labs(y="")

stable &lt;- desc_statby(penguins, 
                   measure.var='body_mass_g',
                   grps='species')
stable &lt;- stable[,c('species','length','mean','sd')]
stable_plt &lt;- ggtexttable(stable, rows=NULL)

ggarrange(dens_plt, stable_plt,
          ncol=1, heights=c(2,1))
```
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;
]

---

### Add tables to a graphic

.pull-left[

```r
library(ggsci)
dens_plt &lt;- ggplot(penguins, 
                   aes(x = body_mass_g))+
  geom_density(aes(fill=species))+
  scale_fill_jco(alpha=0.3)+
  theme_classic() +
  theme(axis.text.y = element_blank(),
        legend.position='top') +
* stat_central_tendency(
*   aes(color=species),
*   type='mean',
*   geom='line', linetype=2
* ) +
* scale_color_jco() +
  labs(y = "")

stable &lt;- desc_statby(penguins, 
                   measure.var='body_mass_g',
                   grps='species')
stable &lt;- stable[,c('species','length','mean','sd')]
stable_plt &lt;- ggtexttable(stable, rows=NULL)

ggarrange(dens_plt, stable_plt,
          ncol=1, heights=c(2,1))
```
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;

]

---

.pull-left[

```r
ggscatter(penguins,
          x='bill_length_mm',
          y='body_mass_g',
          color='species',
          shape='species',
          size=0.5,
          ellipse=TRUE)+
  stat_mean(aes(color=species, shape=species), size=4)
```
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;
]

---
layout: true

## Modeling results

---

Let's start with a fairly naive multiple regression model


```r
m1 &lt;- lm(body_mass_g ~., data=penguins)
summary(m1)$coef
```

```
                     Estimate   Std. Error    t value     Pr(&gt;|t|)
(Intercept)       84087.94460 41912.018942  2.0062967 4.565793e-02
speciesChinstrap   -282.53947    88.790344 -3.1820968 1.604233e-03
speciesGentoo       890.95818   144.563079  6.1631102 2.124019e-09
islandDream         -21.18017    58.390407 -0.3627337 7.170410e-01
islandTorgersen     -58.77708    60.852126 -0.9659003 3.348167e-01
bill_length_mm       18.96388     7.111843  2.6665210 8.049880e-03
bill_depth_mm        60.79775    20.002232  3.0395481 2.562907e-03
flipper_length_mm    18.50387     3.128430  5.9147481 8.464766e-09
sexmale             378.97704    48.074295  7.8831534 4.948533e-14
year                -42.78456    20.949432 -2.0422775 4.193578e-02
```

---



count: false
 

.panel1-mod1-auto[

```r
*library(gtsummary)
```
]
 
.panel2-mod1-auto[

]

---
count: false
 

.panel1-mod1-auto[

```r
library(gtsummary)
*theme_gtsummary_compact()
```
]
 
.panel2-mod1-auto[

]

---
count: false
 

.panel1-mod1-auto[

```r
library(gtsummary)
theme_gtsummary_compact()
*tbl_regression(m1,
* label = list(
*   bill_length_mm ~ 'Bill length (mm)',
*   bill_depth_mm ~ 'Bill depth (mm)',
*   flipper_length_mm ~ 'Flipper length (mm)',
*   species ~ 'Species',
*   island ~ 'Island',
*   sex ~ 'Sex',
*   year ~ 'Year')
*) 
```
]
 
.panel2-mod1-auto[
preservedb302acb7dea8a3d
]

---
count: false
 

.panel1-mod1-auto[

```r
library(gtsummary)
theme_gtsummary_compact()
tbl_regression(m1,
  label = list(
    bill_length_mm ~ 'Bill length (mm)',
    bill_depth_mm ~ 'Bill depth (mm)',
    flipper_length_mm ~ 'Flipper length (mm)',
    species ~ 'Species',
    island ~ 'Island',
    sex ~ 'Sex',
    year ~ 'Year')
) %&gt;%
* add_global_p()
```
]
 
.panel2-mod1-auto[
preserve70e3efed31ef5a1c
]

---
count: false
 

.panel1-mod1-auto[

```r
library(gtsummary)
theme_gtsummary_compact()
tbl_regression(m1,
  label = list(
    bill_length_mm ~ 'Bill length (mm)',
    bill_depth_mm ~ 'Bill depth (mm)',
    flipper_length_mm ~ 'Flipper length (mm)',
    species ~ 'Species',
    island ~ 'Island',
    sex ~ 'Sex',
    year ~ 'Year')
) %&gt;%
  add_global_p() %&gt;%
* bold_p(t = 0.05)
```
]
 
.panel2-mod1-auto[
preservee538e67da83dc682
]

---
count: false
 

.panel1-mod1-auto[

```r
library(gtsummary)
theme_gtsummary_compact()
tbl_regression(m1,
  label = list(
    bill_length_mm ~ 'Bill length (mm)',
    bill_depth_mm ~ 'Bill depth (mm)',
    flipper_length_mm ~ 'Flipper length (mm)',
    species ~ 'Species',
    island ~ 'Island',
    sex ~ 'Sex',
    year ~ 'Year')
) %&gt;%
  add_global_p() %&gt;%
  bold_p(t = 0.05) %&gt;%
* bold_labels()
```
]
 
.panel2-mod1-auto[
preserve4aae10d824418213
]

---
count: false
 

.panel1-mod1-auto[

```r
library(gtsummary)
theme_gtsummary_compact()
tbl_regression(m1,
  label = list(
    bill_length_mm ~ 'Bill length (mm)',
    bill_depth_mm ~ 'Bill depth (mm)',
    flipper_length_mm ~ 'Flipper length (mm)',
    species ~ 'Species',
    island ~ 'Island',
    sex ~ 'Sex',
    year ~ 'Year')
) %&gt;%
  add_global_p() %&gt;%
  bold_p(t = 0.05) %&gt;%
  bold_labels() %&gt;%
* italicize_levels()
```
]
 
.panel2-mod1-auto[
preserve3f46698eb29c82dc
]

&lt;style&gt;
.panel1-mod1-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-mod1-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-mod1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

### Putting together multiple models

.pull-left[

```r
(gt_r1 &lt;- glm(response ~ trt + grade, trial, 
              family = binomial) %&gt;%
  tbl_regression(exponentiate = TRUE))
```



]
.pull-right[
preservece78e1b69e63de5b
]

---

### Putting together multiple models

.pull-left[

```r
(gt_r2 &lt;- coxph(Surv(ttdeath, death) ~ trt + grade,
                trial) %&gt;%
  tbl_regression(exponentiate = TRUE))
```

]
.pull-right[
preservea8e8d46170a799d7

]

---

### Putting together multiple models

.pull-left[

```r
(gt_t1 &lt;- trial[c("trt", "grade")] %&gt;% 
  tbl_summary(missing = "no") %&gt;% 
  add_n() %&gt;%
  modify_header(stat_0 ~ "**n (%)**") %&gt;%
  modify_footnote(stat_0 ~ NA_character_))
```

]
.pull-right[
preserve3e4bd5fb1314577c

]

---

### Putting together multiple models


```r
tbl_merge(
  list(gt_t1, gt_r1, gt_r2),
  tab_spanner = c(NA_character_, "**Tumor Response**", "**Time to Death**")
)
```

preservecbab918c1ae4dd6d

---

### The finalfit package


```r
explanatory &lt;- setdiff(names(penguins), 'body_mass_g')
dependent &lt;- 'body_mass_g'
t2 &lt;- penguins %&gt;% 
  finalfit::finalfit(dependent, explanatory, metrics=TRUE)
knitr::kable(t2[[1]], row.names = F)
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Dependent: body_mass_g &lt;/th&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; unit &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; value &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Coefficient (univariable) &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Coefficient (multivariable) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; species &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Adelie &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3700.7 (458.6) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Chinstrap &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3733.1 (384.3) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 32.43 (-100.37 to 165.22, p=0.631) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -282.54 (-457.22 to -107.86, p=0.002) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Gentoo &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 5076.0 (504.1) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1375.35 (1264.91 to 1485.80, p&amp;lt;0.001) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 890.96 (606.55 to 1175.36, p&amp;lt;0.001) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; island &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Biscoe &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4716.0 (782.9) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dream &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3712.9 (416.6) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -1003.11 (-1149.16 to -857.07, p&amp;lt;0.001) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -21.18 (-136.05 to 93.69, p=0.717) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Torgersen &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3706.4 (445.1) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -1009.65 (-1206.75 to -812.54, p&amp;lt;0.001) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -58.78 (-178.49 to 60.94, p=0.335) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bill_length_mm &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; [32.1,59.6] &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4201.8 (802.0) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 87.42 (74.82 to 100.01, p&amp;lt;0.001) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 18.96 (4.97 to 32.96, p=0.008) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bill_depth_mm &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; [13.1,21.5] &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4201.8 (802.0) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -191.64 (-229.84 to -153.45, p&amp;lt;0.001) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 60.80 (21.45 to 100.15, p=0.003) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; flipper_length_mm &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; [172.0,231.0] &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4201.8 (802.0) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 49.69 (46.70 to 52.67, p&amp;lt;0.001) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 18.50 (12.35 to 24.66, p&amp;lt;0.001) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; sex &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; female &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3862.3 (666.2) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; male &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4545.7 (787.6) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 683.41 (526.02 to 840.80, p&amp;lt;0.001) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 378.98 (284.40 to 473.56, p&amp;lt;0.001) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; year &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4124.5 (792.5) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2008 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4266.7 (789.5) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2009 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Mean (sd) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4210.3 (822.9) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; - &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 41.42 (-63.17 to 146.02, p=0.437) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -42.78 (-84.00 to -1.57, p=0.042) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

### Other packages

+ **sjPlot** [(link)](https://strengejacke.github.io/sjPlot/articles/tab_model_estimates.html)
+ **stargazer**

#### Utility packages

The function `broom::tidy` takes results from  [many](https://broom.tidymodels.org/articles/available-methods.html) models and transforms
them into _tidy datasets_, which can be formatted and output using a variety of
other packages in the R ecosystem. Some popular and effective packages are

+ **gt**: The grammar of tables [(link)](https://gt.rstudio.com)
+ **flextable**: Creating tables that can work with RMarkdown/HTML as well as the [officeverse](https://ardata-fr.github.io/officeverse/), which creates Microsoft Word and Powerpoint files from R and RMarkdown [(link)](https://ardata-fr.github.io/flextable-book/index.html)
+ **pixiedust** is designed to format the results from the `broom::tidy` [(link)](https://github.com/nutterb/pixiedust)
* **xtable** and **stargazer** are targeted towards \LaTeX and PDF outputs

.footnote[This slide differs from the video. It was updated in 2021]

---
layout: true

## Model results
### Plotting results

---

.pull-left[

```r
out &lt;- broom::tidy(m1) %&gt;% 
  slice(-1) %&gt;% 
  mutate(lcb = estimate - 2*std.error,
         ucb = estimate + 2*std.error) %&gt;% 
  select(term, estimate, lcb, ucb)
knitr::kable(out, digits = 2) %&gt;% 
  kable_styling()
```



]
.pull-right[
&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; lcb &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; ucb &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; speciesChinstrap &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -282.54 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -460.12 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -104.96 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; speciesGentoo &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 890.96 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 601.83 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1180.08 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; islandDream &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -21.18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -137.96 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 95.60 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; islandTorgersen &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -58.78 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -180.48 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.93 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bill_length_mm &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.96 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.74 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33.19 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bill_depth_mm &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60.80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20.79 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100.80 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; flipper_length_mm &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.50 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12.25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24.76 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; sexmale &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 378.98 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 282.83 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 475.13 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; year &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -42.78 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -84.68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.89 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

---

.pull-left[


```r
(plt1 &lt;- out %&gt;% 
  ggplot(aes(x = term, y = estimate,
             ymin = lcb, ymax = ucb))+
  geom_pointrange()+
  geom_hline(yintercept=0, linetype=2)+
  xlab('') + geom_vline(xintercept=0, linetype=2)+
  coord_flip() + theme_classic())
```

]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-24-1.png)&lt;!-- --&gt;

]

---

.pull-left[


```r
(plt1 &lt;- out %&gt;% 
  ggplot(aes(x = term, y = estimate,
             ymin = lcb, ymax = ucb))+
  geom_pointrange()+
  geom_hline(yintercept=0, linetype=2)+
  xlab('') + geom_vline(xintercept=0, linetype=2)+
  coord_flip() + theme_classic())
```

```r
out &lt;- out %&gt;% 
  mutate(across(-term, round, 2)) %&gt;% 
  mutate(ci = glue::glue('{estimate} ({lcb},{ucb})'))
plt2 &lt;- ggplot(out, aes(x = term, y = 0))+
  geom_text(aes(label=ci), size=3, hjust=0)+
  coord_flip()+theme_void() + scale_y_continuous(limits = c(-0.1, 0.2))
ggpubr::ggarrange(plt1, plt2, nrow=1, widths=c(2,1), align='h')
```



]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;

]

---

We can use the **coefplot** package to make a similar plot

.pull-left[

```r
pacman::p_load("coefplot")
coefplot(m1, intercept=FALSE)
```
.footnote[This slide differs from the video. It was updated in 2021]

]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;
]

---

.pull-left[
We can also use the **see** package


```r
pacman::p_load(see, parameters)
plot(model_parameters(m1), show_labels = TRUE)
```

.footnote[This slide differs from the video. It was updated in 2021]

]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;
]

---

layout: true

## Model results 
### Survival analysis


---

.pull-left[

```r
library(survival)
library(survminer)
pbc &lt;- pbc %&gt;% mutate(trt = as.factor(trt), stage = as.factor(stage))
m &lt;- survfit(Surv(time, status==2)~trt, data=pbc)
ggsurvplot(m, pval=TRUE, risk.table=T)
```
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-30-1.png)&lt;!-- --&gt;

]

---

.pull-left[

```r
library(survival)
library(survminer)
pbc &lt;- pbc %&gt;% mutate(trt = as.factor(trt), stage = as.factor(stage))
m &lt;- survfit(Surv(time, status==2)~trt, data=pbc)
ggsurvplot(m, pval=TRUE, risk.table=T)
```

```r
m2 &lt;- coxph(Surv(time, status==2) ~ trt, data = pbc)
gtsummary::tbl_regression(m2, exponentiate=T)
```
]
.pull-right[
preservefa538ab9eac99275

]

---

.pull-left[



```r
m3 &lt;- coxph(Surv(time, status==2) ~ trt + sex + 
              age + stage, data=pbc)
out &lt;- broom::tidy(m3) %&gt;% 
  mutate(lcb = estimate - 2*std.error,
         ucb = estimate + 2*std.error) %&gt;% 
  mutate(across(c(estimate,lcb,ucb), exp))
*gtsummary::tbl_regression(m3, exponentiate = T)
```

preserve5d634018ef9b25bf
]
.pull-right[

```r
out %&gt;% 
  ggplot(aes(x = term, y = estimate,
             ymin = lcb, ymax=ucb))+
  geom_pointrange()+
  geom_hline(yintercept=1, linetype=2)+
  coord_flip()+
  theme_classic()
```

![](01_vis_analytics_files/figure-html/unnamed-chunk-35-1.png)&lt;!-- --&gt;

]

---

.pull-left[

```r
ggsurvplot(
    m, pval = TRUE, risk.table = FALSE,
    palette="jama",
    xlab = "Days",
    legend.title="",
*   facet.by = "stage",
    legend.labs=c("Control","Treatment")
)
```

.footnote[This slide differs from the video and was updated in 2021]
]
.pull-right[
![](01_vis_analytics_files/figure-html/unnamed-chunk-36-1.png)&lt;!-- --&gt;
]




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../../js/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLanguage": "r",
"countIncrementalSlides": false,
"highlightStyle": "tomorrow-night-bright",
"highlightLines": true,
"slideNumberFormat": "%current%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
